<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>On Bir Partisi</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen flex items-center justify-center">
<div class="w-[90%] max-w-5xl mx-auto">
  <div class="bg-white rounded-2xl shadow-xl p-10" id="app"></div>
</div>

<script>
let playerName = ""
let party = null
let currentNumber = 0
let currentPlayerIndex = 0

function renderHome() {
  document.getElementById("app").innerHTML = `
    <div class="space-y-8">
      <div>
        <h1 class="text-3xl font-semibold">On Bir Partisi</h1>
        <p class="text-slate-500 mt-2">Adınızı girin ve parti oluşturun veya katılın.</p>
      </div>
      <div>
        <input id="nameInput" placeholder="Adınız" class="w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-black" />
      </div>
      <div>
        <button onclick="setName()" class="px-5 py-3 bg-black text-white rounded-xl hover:opacity-80 transition">Devam Et</button>
      </div>
    </div>
  `
}

function setName() {
  const name = document.getElementById("nameInput").value.trim()
  if (!name) return
  playerName = name
  renderLobbyChoice()
}

function renderLobbyChoice() {
  document.getElementById("app").innerHTML = `
    <div class="space-y-8">
      <div>
        <h2 class="text-2xl font-semibold">Hoşgeldiniz, ${playerName}</h2>
      </div>
      <div class="flex gap-4">
        <button onclick="createParty()" class="px-5 py-3 bg-black text-white rounded-xl hover:opacity-80 transition">Parti Oluştur</button>
        <button onclick="renderJoin()" class="px-5 py-3 border rounded-xl hover:bg-slate-100 transition">Partiye Katıl</button>
      </div>
    </div>
  `
}

function createParty() {
  const code = Math.random().toString(36).substring(2, 7).toUpperCase()
  party = { code: code, players: [playerName] }
  renderLobby()
}

function renderJoin() {
  document.getElementById("app").innerHTML = `
    <div class="space-y-8">
      <div>
        <h2 class="text-2xl font-semibold">Partiye Katıl</h2>
      </div>
      <div class="flex gap-3">
        <input id="codeInput" placeholder="Parti kodunu girin" class="flex-1 px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-black" />
        <button onclick="joinParty()" class="px-5 py-3 bg-black text-white rounded-xl hover:opacity-80 transition">Katıl</button>
      </div>
      <button onclick="renderLobbyChoice()" class="text-sm text-slate-500 underline">Geri</button>
    </div>
  `
}

function joinParty() {
  const code = document.getElementById("codeInput").value.trim().toUpperCase()
  if (!code) return
  if (party && party.code === code) {
    party.players.push(playerName)
    renderLobby()
  }
}

function renderLobby() {
  document.getElementById("app").innerHTML = `
    <div class="space-y-8">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-2xl font-semibold">Parti Lobi</h2>
          <p class="text-slate-500 mt-1">Kod: <span class="font-medium text-black">${party.code}</span></p>
        </div>
        <button onclick="startGame()" class="px-5 py-3 bg-black text-white rounded-xl hover:opacity-80 transition">Başlat</button>
      </div>
      <div class="grid grid-cols-4 gap-3">
        ${party.players.map((p, i) => `<div class="p-4 rounded-xl border bg-slate-100 text-center">${i+1}. ${p}</div>`).join("")}
      </div>
    </div>
  `
}

function startGame() {
  currentNumber = 0
  currentPlayerIndex = 0
  renderGame()
}

function renderGame(message = "") {
  const currentPlayer = party.players[currentPlayerIndex]
  document.getElementById("app").innerHTML = `
    <div class="space-y-8">
      <div class="flex justify-between items-center">
        <h2 class="text-2xl font-semibold">Mevcut Sayı: ${currentNumber}</h2>
        <span class="text-slate-500">Sıra: ${currentPlayer}</span>
      </div>
      <div>
        <input id="numberInput" placeholder="1-3 sayı girin" class="w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-black" />
      </div>
      <div>
        <button onclick="submitMove()" class="px-5 py-3 bg-black text-white rounded-xl hover:opacity-80 transition">Gönder</button>
      </div>
      <div class="text-sm text-slate-500">${message}</div>
      <div class="mt-4">
        <h3 class="font-semibold">Sınıf Sıraları:</h3>
        <div class="grid grid-cols-4 gap-3">
          ${party.players.map((p, i) => `<div class="p-3 rounded-lg border text-center ${i === currentPlayerIndex ? 'bg-black text-white' : 'bg-slate-100'}">${i+1}. ${p}</div>`).join("")}
        </div>
      </div>
    </div>
  `
}

function submitMove() {
  const input = document.getElementById("numberInput").value
  const numbers = input.split(",").map(n => parseInt(n.trim())).filter(n => !isNaN(n))
  if (numbers.length === 0 || numbers.length > 3) {
    renderGame("1 ila 3 sayı girmelisiniz.")
    return
  }
  for (let i = 0; i < numbers.length; i++) {
    if (numbers[i] !== currentNumber + i + 1) {
      renderGame("Sayılar sırayla devam etmelidir.")
      return
    }
  }
  currentNumber = numbers[numbers.length - 1]
  if (currentNumber >= 11) {
    renderEnd(party.players[currentPlayerIndex] + " 11'i söyledi ve kaybetti.")
    return
  }
  currentPlayerIndex = (currentPlayerIndex + 1) % party.players.length
  renderGame()
}

function renderEnd(message) {
  document.getElementById("app").innerHTML = `
    <div class="space-y-6 text-center">
      <h2 class="text-2xl font-semibold">Oyun Bitti</h2>
      <p class="text-slate-500">${message}</p>
      <button onclick="startGame()" class="px-5 py-3 bg-black text-white rounded-xl hover:opacity-80 transition">Tekrar Oyna</button>
    </div>
  `
}

renderHome()
</script>
</body>
</html>
